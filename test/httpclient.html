<!--
 * @Author: your name
 * @Date: 2021-09-14 22:38:14
 * @LastEditTime: 2021-09-15 21:31:00
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /ECTSM-node/test/httpclient.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="../dist/httpclient-min.js"></script>
    <script>
        async function HttpRequest() {
            //new ecthttpclient instance as a global single instance
            //publicKeyUrl endpoint to get unix time and public key form server
            let success = await hc.Init("http://127.0.0.1:8080/ectminfo");
            if (success == false) {
                console.error("new ECTHttpClient error");
                return
            }
            //get
            {
                const url = "http://127.0.0.1:8080/test/get";
                //send request with default timeout and token 'usertoken'
                const {
                    reqResp,
                    decryptBody,
                    err
                } = await hc.ECTGet(url, "usertoken", {
                    timeout: 30000
                });

                if (err != null) {
                    console.log("err", err);
                }
                console.log("status", reqResp.status);
                console.log("get request reponse", decryptBody.toString());
            }

            //post
            {
                const sendData = {
                    Name: "Jack",
                    Email: "jack@gmail.com",
                    Phone: "123456789",
                    Age: 18,
                };
                let sendDataStr = JSON.stringify(sendData)

                const url = "http://127.0.0.1:8080/test/post";
                const {
                    reqResp,
                    decryptBody,
                    err
                } = await hc.ECTPost(url, sendDataStr, "usertoken");

                if (err != null) {
                    console.log("err", err);
                }
                console.log("status", reqResp.status);
                console.log("get request reponse", decryptBody.toString());

            }
        }

        HttpRequest();
    </script>
</body>

</html>